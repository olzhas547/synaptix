window.jQuery&&window.jQuery.fn.bem&&window.bemhtml&&BEM.DOM.decl("serp-controller",{_viewerItems:[],_viewParams:["img_url","ogl_url","rlt_url","rpt","pos"],_viewParamsSimilar:["img_url","ogl_url","rlt_url","pos"],bindEvents:function(){var e=this.__base.apply(this,arguments);return window.Ya.reactBus&&window.Ya.reactBus.on("images-viewer:fill",this._onViewerFill,this).on("images-viewer:open",this._onImagesViewerOpen,this).on("images-viewer:openRimFromHistory",this._openViewerRimImage,this),e},unbindEvents:function(){return window.Ya.reactBus&&window.Ya.reactBus.off("images-viewer:fill",this._onViewerFill).off("images-viewer:open",this._onImagesViewerOpen).off("images-viewer:openRimFromHistory",this._openViewerRimImage),this.__base.apply(this,arguments)},_onImagesViewerOpen:function(e){this._activeId=e.activeId},_onViewerFill:function(e,i){var t,s;for(i&&(this._viewerItems=[]),s=0;s<e.length;s++)t=e[s],this._viewerItems[t.pos]=t},_onViewerSelectItem:function(e){if(!(this._isImagesApp()&&e&&e.initialLoading&&void 0!==window.history.state.views))return this.__base.apply(this,arguments);var i=e.itemParams;if(i){var t=this._setCurrentItemById.bind(this,i.id);setTimeout(t,0)}},_setCurrentItemById:function(e){var i=this.getItemById(e);BEM.blocks["serp-item"].setCurrent(i)},_onLocationChanged:function(e,i){if(!this._isImagesApp())return this.__base.apply(this,arguments);var t=Object.assign({viewedRimUrls:this._viewedRimUrls},i);window.Ya.reactBus.emit("serp-controller:locationChanged",t)},_onPageTypeChanged:function(e){"search"!==e?this.__base.apply(this,arguments):BEM.blocks.uri.getParamValue("pos")?this._setCurrentItemById(this._activeId):window.scrollTo(0,0)},getItemParamsByPos:function(e){return this._isImagesApp()?this._viewerItems[e]||null:this.__base.apply(this,arguments)},_onViewerMounted:function(){if(!this._isImagesApp())return this.__base.apply(this,arguments)},_onViewerGalleryListOut:function(){if(!this._isImagesApp())return this.__base.apply(this,arguments)},_isImagesApp:function(){return"search"===this.getMod("page")&&!window.Ya.InternalState.isCbirPage}});